<html>
    <head>
        <style>
            /*SHAPE*/
            .gray-wire {
                fill: rgba(0,0,0,0);
                stroke:gray;
                stroke-width:3;
            }
            .red-wire {
                fill: rgba(0,0,0,0);
                stroke:red;
                stroke-width:3;
            }
            .green-wire {
                fill: rgba(0,0,0,0);
                stroke:green;
                stroke-width:3;
            }
            .blue-wire {
                fill: rgba(0,0,0,0);
                stroke:blue;
                stroke-width:3;
            }
            .yellow-wire {
                fill: rgba(0,0,0,0);
                stroke: yellow;
                stroke-width: 3;
            }

            /*LINE*/
            .gray-line {
                stroke:gray;
                stroke-width:3;
            }
            .red-line {
                stroke:red;
                stroke-width:3;
            }
            .green-line {
                stroke:green;
                stroke-width:3;
            }
            .blue-line {
                stroke:blue;
                stroke-width:3;
            }
            .yellow-line {
                stroke:yellow;
                stroke-width:3;
            }

            /*TEXT*/
            .black-text {
                fill:black;
            }
            .gray-text {
                fill:gray;
            }
            .red-text {
                fill:red
            }
            .green-text {
                fill:green;
            }
            .blue-text {
                fill:blue;
            }
            .yellow-text {
                fill:yellow;
            }

            .implement-text {
                font-size: large;
                font-weight:900;
            }

            keyword {
                color:red;
            }
        </style>
    </head>

    <body>
        <div>
            Inspiration Book《3D Game Programming with DirectX12》Frank D.Luna
        </div>
        <hr />

        <code>四棱锥截取的平截头体</code>
        <svg width="100%" height="420">
            <rect class="gray-wire" x="400" y="0" width="500" height="250"></rect>
            <text class="black-text" x="410" y="20">far-plane</text>
            <rect class="gray-wire" x="200" y="200" width="250" height="125"></rect>
            <text class="black-text" x="210" y="220">near-plane</text>
            <line class="gray-line" x1="0" y1="400" x2="400" y2="0"></line>
            <line class="gray-line" x1="0" y1="400" x2="900" y2="0"></line>
            <line class="gray-line" x1="0" y1="400" x2="400" y2="250"></line>
            <line class="gray-line" x1="0" y1="400" x2="900" y2="250"></line>
            <text class="black-text" x="0" y="410">Viewer-position</text>

            <polyline class="red-line" points="147.959091,375.340149 147.504913,372.754761 147.005554,370.177734 146.461182,367.609833 145.871948,365.051880 145.238052,362.504578 144.559677,359.968781 143.837036,357.445251 143.070343,354.934753 142.259827,352.438049 141.405762,349.955902 140.508377,347.489075 139.567963,345.038361 138.584808,342.604462 137.559219,340.188141">
            </polyline>
            <text class="red-text" x="150" y="360">α(vertical field of view angle)</text>

            <polyline class="blue-line" points="118.795502,347.201996 116.946823,345.553345 115.077110,343.953064 113.187477,342.401428 111.279053,340.898621 109.352974,339.444855 107.410355,338.040222 105.452332,336.684875 103.480034,335.378937 101.494576,334.122467 99.497101,332.915527 97.488716,331.758148 95.470551,330.650330 93.443703,329.592102 91.409309,328.583344 89.368469,327.624054 87.322289,326.714142 85.271866,325.853455 83.218285,325.041901 81.162659,324.279297 79.106033,323.565491">
            </polyline>
            <text class="blue-text" x="110" y="320">β(horizontal field of view angle)</text>
        </svg>

        <div style="height: 400px">
            <!-- Y-Z -->
            <svg width="50%" height="400" style="position:absolute">
                <line class="gray-line" x1="0" y1="200" x2="500" y2="0"></line>
                <line class="gray-line" x1="0" y1="200" x2="500" y2="400"></line>

                <line class="green-line" x1="1" y1="200" x2="1" y2="0"></line>
                <text class="green-text" x="1" y="30">+Y</text>
                <line class="green-line" x1="0" y1="200" x2="520" y2="200"></line>
                <text class="green-text" x="510" y="195">+Z</text>

                <line class="gray-line" x1="245" y1="100" x2="255" y2="100"></line>
                <line class="gray-line" x1="245" y1="300" x2="255" y2="300"></line>
                <line class="gray-line" x1="250" y1="100" x2="250" y2="300"></line>
                <text class="black-text" x="230" y="90">near-plane</text>
                <line class="gray-line" x1="500" y1="0" x2="500" y2="400"></line>
                <text class="black-text" x="500" y="15">far-plane</text>

                <line class="red-line" x1="0" y1="200" x2="0" y2="210"></line>
                <line class="red-line" x1="150" y1="200" x2="150" y2="210"></line>
                <line class="red-line" x1="0" y1="205" x2="150" y2="205"></line>
                <text class="red-text" x="75" y="220">d</text>

                <line class="red-line" x1="150" y1="140" x2="160" y2="140"></line>
                <line class="red-line" x1="150" y1="200" x2="160" y2="200"></line>
                <line class="red-line" x1="155" y1="140" x2="155" y2="200"></line>
                <text class="red-text" x="160" y="170">1</text>

                <polyline class="blue-line" points="90.000000,200.000000 89.986221,198.425079 89.944878,196.850647 89.875999,195.277176 89.779594,193.705139 89.655693,192.135040 89.504333,190.567352 89.325562,189.002548 89.119438,187.441116 88.886024,185.883530 88.625389,184.330261 88.337608,182.781799 88.022781,181.238617 87.680992,179.701157 87.312355,178.169937 86.916985,176.645386 86.494987,175.127991 86.046501,173.618210 85.571671,172.116516 85.070633,170.623352 84.543541,169.139191 83.990562,167.664490">
                </polyline>
                <text class="blue-text" x="90" y="185">α/2</text>

                <line class="yellow-line" x1="0" y1="200" x2="380" y2="150"></line>
                <text class="blue-text implement-text" x="380" y="150">y</text>
                <text class="blue-text implement-text" x="145" y="185">y1</text>
            </svg>

            <!-- X-Z -->
            <svg width="50%" height="400" style="position:absolute; margin-left:50%">
                <line class="gray-line" x1="200" y1="400" x2="0" y2="0"></line>
                <line class="gray-line" x1="200" y1="400" x2="400" y2="0"></line>

                <line class="green-line" x1="200" y1="400" x2="200" y2="0"></line>
                <text class="green-text" x="200" y="20">+Z</text>
                <line class="green-line" x1="200" y1="399" x2="420" y2="399"></line>
                <text class="green-text" x="420" y="390">+X</text>

                <line class="gray-line" x1="100" y1="200" x2="300" y2="200"></line>
                <text class="black-text" x="302" y="200">near-plane</text>

                <line class="gray-line" x1="0" y1="1" x2="400" y2="1"></line>
                <text class="black-text" x="402" y="15">far-plane</text>

                <line class="red-line" x1="205" y1="400" x2="205" y2="280"></line>
                <line class="red-line" x1="200" y1="400" x2="210" y2="400"></line>
                <line class="red-line" x1="200" y1="280" x2="210" y2="280"></line>
                <text class="red-text" x="210" y="338">d</text>

                <line class="red-line" x1="200" y1="275" x2="135" y2="275"></line>
                <line class="red-line" x1="200" y1="270" x2="200" y2="280"></line>
                <line class="red-line" x1="135" y1="270" x2="135" y2="280"></line>
                <text class="red-text" x="165" y="270">r</text>

                <polyline class="blue-line" points="200.000000,310.000000 198.425079,310.013794 196.850632,310.055115 195.277161,310.123993 193.705124,310.220398 192.135025,310.344299 190.567322,310.495667 189.002518,310.674438 187.441086,310.880554 185.883499,311.113983 184.330231,311.374634 182.781754,311.662415 181.238556,311.977234 179.701111,312.319031 178.169876,312.687653 176.645325,313.083038 175.127930,313.505035 173.618149,313.953522 172.116455,314.428345 170.623291,314.929382 169.139114,315.456482 167.664398,316.009460 166.199600,316.588165 164.745132,317.192413 163.301468,317.822021 161.869049,318.476807 160.448303,319.156555">
                </polyline>
                <text class="blue-text" x="160" y="305">β/2</text>

                <line class="yellow-line" x1="200" y1="400" x2="160" y2="100"></line>
                <text class="blue-text implement-text" x="160" y="100">x</text>
                <text class="blue-text implement-text" x="175" y="280">x1</text>
            </svg> 
        </div>
        <br />
        <table border="1" cellpadding="5" cellspacing="0">
            <thead> <tr><th colspan="3">Persepective变换</th></tr> </thead>
            <tbody>
                <tr>
                    <td>思路</td>
                    <td>世界空间->标准屏幕空间</td>
                </tr>
                
                <tr>
                    <td>思路2</td>
                    <td>(x, y, z) -> (x1, y1, <keyword>z1</keyword>)</td>
                    <td>abs(x1) <= 1.0, abs(y1) <= 1.0, 0< <keyword>z1</keyword> < 1 </td>
                </tr>

                <tr>
                    <td><keyword>d</keyword></td>
                    <td>
                        <code>tan(α/2) = 1/d</code><br />
                        <code>d = 1/tan(α/2)</code><br />
                        <code>d = cot(α/2)</code>
                    </td>
                </tr>

                <tr>
                    <td><keyword>β</keyword></td>
                    <td>
                        <code>β/2 = atan(r/d)</code><br />
                        <code>β = atan(r/cot(α/2))*2</code><br />
                        <code>β = 2*atan(r/cot(α/2))</code><br />
                        <code>β = 2*atan(r*tan(α/2))</code>
                    </td>
                    <td>没用</td>
                </tr>

                <tr>
                    <td>x1</td>
                    <td>
                        <code>x/z = x1/d</code><br />
                        <code>x/z*cot(α/2) = x1</code><br />
                        <code>x/(z*tan(α/2)) = x1</code><br />
                        <keyword>此时abs(x1) <= r, 需要归一化 </keyword><br />
                        <code>x/(r*z*tan(α/2)) = x1</code><br />
                    </td>
                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>x</code><br />
                        <code>——————————</code><br />
                        <code>r*z*tan(α/2)</code>
                    </td>
                </tr>  

                <tr>
                    <td>y1</td>
                    <td>
                        <code>y/z = y1/d</code><br />
                        <code>d*y/z = y1</code><br />
                        <code>cot(α/2)*y/z = y1</code><br />
                        <code>y/(z*tan(α/2)) = y1</code>
                    </td>
                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>y</code><br />
                        <code>——————————</code><br />
                        <code>z*tan(α/2)</code>
                    </td>
                </tr>

                <tr>
                    <td>矩阵</td>
                    <td>
                        <table>
                            <tr>
                                <td>1/(r*z*tan(α/2))</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>1/(z*tan(α/2))</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>z1/z</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                                <td>1</td>
                            </tr>

                            <tr>
                                <td colspan="4">因为gpu会进行<深度除法>, 因此可以将矩阵中关于< z分量 >的< 除法 >消掉,<br />
                                    与< w分量 >点乘的一列(一行)第3个元素为1</td>
                            </tr>

                            <tr>
                                <td>1/(r*tan(α/2))</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>1/tan(α/2)</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>A</td>
                                <td>B</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>1</td>
                                <td>0</td>
                            </tr>
                            
                            <tr>
                                <td colspan="4">----</td>
                            </tr>
                            
                            <tr>
                                <td>cot(α/2)/r</td>
                                <td>0</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>cot(α/2)</td>
                                <td>0</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>A</td>
                                <td>B</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>0</td>
                                <td>1</td>
                                <td>0</td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </tbody>
        </table>
    </body>

</html>
